l r8 d2 Color
add r14 r8 LogicType.Channel0
get r8 db r8
move sp 6
Start:
yield
l r0 d0 On
breqz r0 -1
l r0 d0 PositionX
bna r0 353 0.00354 TravelHome
l r0 d0 PositionZ
bap r0 r8 0.00225 CheckOre
TravelHome:
s db:0 r14 STR("TvlHme")
s d0 TargetX 353
s d0 TargetZ r8
jal Travel
CheckOre:
s db:0 r14 STR("ChkOre")
move r11 2
move r12 0
ls r0 d0 r11 Occupied
add r12 r0 r12
add r11 r11 1
brlt r11 10 -3
beqz r12 ChargeLoop
UnloadLoop:
yield
s db:0 r14 STR("Unload")
s d0 TargetX 355
s d0 TargetZ 559
jal Travel
s d0 Mode 4
l r1 d0 Mode
breq r1 4 -1
yield
j CheckOre
ChargeLoop:
s db:0 r14 STR("Chgelp")
s d0 TargetX 353
s d0 TargetZ r8
jal Travel
yield
ls r2 d0 0 Charge
l r10 d5 Setting
brlt r2 71500 -3
bgtz r10 Shutdown
bgtz r13 Shutdown
MineTravel:
s db:0 r14 STR("TvlWpM")
lbn r7 -851746783 HASH("WAYZ") Setting 0
lbn r6 -851746783 HASH("WAYX") Setting 0
s d0 TargetX r6
s d0 TargetZ r7
s d0 Mode 2
jal CheckRecall
jal Travel
GoMine:
lbn r4 -851746783 HASH("MINEX") Setting 0
lbn r5 -851746783 HASH("MINEZ") Setting 0
s db:0 r14 STR("TrvlMn")
s d0 TargetX r4
s d0 TargetZ r5
jal CheckRecall
jal Travel
yield
MineLoop:
s db:0 r14 STR("Mine")
s d0 Mode 3
yield
jal CheckRecall
ls r2 d0 0 Charge
blt r2 12000 ReturnToWaypoint
l r9 d0 MineablesInVicinity
blt r9 5 MineablesAtZero
l r1 d0 Mode
beq r1 6 ReturnToWaypoint
j MineLoop
MineablesAtZero:
move r13 1
ReturnToWaypoint:
s db:0 r14 STR("TvlWpH")
s d0 TargetX r6
s d0 TargetZ r7
jal Travel
s db:0 r14 STR("TvlHmP")
s d0 TargetX 330
s d0 TargetZ 559
jal Travel
j TravelHome
Travel:
s d0 Mode 2
TravelLoop:
l r0 d0 PositionY
s d0 TargetY r0
yield
l r0 d0 VelocityMagnitude
slt r3 r0 0.2
mul r3 r3 r3
add r3 r3 r3
bgt r3 20 PathFindLoop
l r1 d0 Mode
lbn r0 HASH("ModularDeviceFlipCoverSwitch") HASH("Mine Override") On Maximum
breqz r0 3
sbn HASH("ModularDeviceFlipCoverSwitch") HASH("Mine Override") On 0
j GoMine
beq r1 2 TravelLoop
j ra
PathFindLoop:
s db:0 r14 STR("Pthfnd")
s d0 Mode 3
sleep 15
s d0 Mode 2
move r3 0
j TravelLoop
j Travel
CheckRecall:
yield
l r10 d5 Setting
bnez r10 ReturnToWaypoint
move r10 0
j ra
Shutdown:
s d0 On 0
move r10 0
move r13 0
j Start
